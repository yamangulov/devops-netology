
# Домашнее задание к занятию "Микросервисы: масштабирование"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развертывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- Поддержка контейнеров;
- Обеспечивать обнаружение сервисов и маршрутизацию запросов;
- Обеспечивать возможность горизонтального масштабирования;
- Обеспечивать возможность автоматического масштабирования;
- Обеспечивать явное разделение ресурсов доступных извне и внутри системы;
- Обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т.п.

Обоснуйте свой выбор.

Решение: проведем сравнительный анализ нескольких самых распространенных оркестраторов

| Функционал                                                 | Docker Swarm                                                                                                                              | Nomad                                                    | Apache Mesos               | Kubernetes(OpenShift) | Yandex Managed Service for Kubernetes® |
|------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|----------------------------|-----------------------|----------------------------------------|
| Поддержка контейнеров                                      | +                                                                                                                                         | +                                                        | +                          | +                     | +                                      |
| обнаружение сервисов и маршрутизация запросов              | +                                                                                                                                         | сам не может, но можно интегрировать с Consult Hashicorp | +                          | +                     | +                                      |
| возможность горизонтального масштабирования                | вручную, автомасштабирование недоступно                                                                                                   | через плагины                                            | +                          | +                     | +                                      |
| автоматическое масштабирование                             | -                                                                                                                                         | +  (в Enterprise версии)                                                      | +     | +                     | +                                      |
| явное разделение ресурсов доступных извне и внутри системы | + (обычно пишут, что нет, но это типичная ошибка, swarm умеет все, что умеет docker, следовательно, можно дать избирательный доступ к отдельным сервисам) | +                                                        | +                          | +                     | +                                      |
| конфигурирование приложения с помощью переменных среды     | +                                                                                                                                         | +                                                        | +                          | +                     | +                                      |

Поскольку речь идет о крупной организации, фактически, у нас стоит выбор между Kubernetes, OpenShift и Apache Mesos. В случае средних и просто больших нагрузок предлагаем Kubernetes или OpenShift, если нужна техподдержка (примерно до 5 000 нод), если компании требуется управление десятками тысяч нод - Apache Mesos. Но Mesos, по описанию источников, хуже автомасштабируется, менее удобен и отстает по сетевым возможностям. Поэтому, если компания имеет и большое кол-во нод, и потребность в эффективном автомасштабировании - можем предложить сочетание k8s и Mesos одновременно. Наконец, возможен третий вариант - компания не является специализированной ИТ фирмой или не имеет возможность содержать достаточное кол-во квалифицированного персонала для этих двух вариантов, но не имеет проблем с финансированием. Тогда лучше всего подходит одно из облачных решений на основе k8s, для примера в таблице я добавил решение от Yandex. В этом случае все усилия на управление кластером k8s на низком уровне берет на себя облако, нужно лишь грамотно настроить параметры автомасштабирования в облаке. Тогда предлагаем облачное решение.



